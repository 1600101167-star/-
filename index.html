<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å°çº¢ä¹¦é£ Â· æš—æ‹æµ‹è¯•</title>
<style>
  :root{
    --primary:#ff2d55;
    --bg:#faf6f7;
    --card:#ffffff;
    --muted:#777;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: -apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",Arial;
    background:var(--bg);
    color:#222;
    -webkit-font-smoothing:antialiased;
  }

  .wrap{
    max-width:520px;
    margin:0 auto;
    padding:18px;
  }

  /* header small XHS style */
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
    margin-top:8px;
  }
  .logo{
    width:44px;height:44px;border-radius:10px;
    background:linear-gradient(135deg,var(--primary), #ff6f87);
    display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;
    box-shadow:0 6px 20px rgba(255,45,85,0.12);
  }
  .brand h1{font-size:18px;margin:0}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  /* cover */
  .cover{
    margin-top:16px;
    text-align:center;
  }
  .cover-card{
    background:var(--card);
    padding:28px 20px;border-radius:22px;
    box-shadow:0 10px 30px rgba(0,0,0,0.06);
  }
  .cover-title{
    color:var(--primary);
    font-size:26px;font-weight:800;margin:0 0 8px;
    letter-spacing:0.6px;
  }
  .cover-desc{color:var(--muted);margin:0 0 14px}
  .input-row{display:flex;gap:10px;justify-content:center;margin-top:8px}
  .name-input{
    width:66%;
    padding:10px 12px;border-radius:12px;border:1px solid #f0d6db;
    outline:none;background:#fff;
    font-size:15px;
  }
  .start-btn{
    background:var(--primary);color:#fff;padding:10px 16px;border-radius:12px;border:none;
    cursor:pointer;font-size:15px;
    box-shadow:0 8px 18px rgba(255,45,85,0.12);
  }
  .start-btn:active{transform:scale(.98)}

  /* test card */
  .card{background:var(--card);padding:20px;border-radius:18px;margin-top:18px;
        box-shadow:0 10px 30px rgba(0,0,0,0.06); animation:floatUp .36s ease;}
  @keyframes floatUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

  .qnum{font-size:13px;color:var(--muted);margin-bottom:8px}
  .question{font-size:18px;font-weight:700;margin-bottom:12px}

  .option{
    background:#fff;border-radius:12px;padding:12px 14px;margin:10px 0;border:1px solid #fee5ea;
    cursor:pointer;font-size:15px;color:#222;
    transition:transform .12s, box-shadow .12s, background .12s;
  }
  .option:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(255,45,85,0.08); background:linear-gradient(90deg,#fff 0%, #fff3f6 100%)}
  .option span{display:inline-block;margin-left:10px}

  /* progress */
  .progress-wrap{margin-top:12px;height:10px;background:#f3f3f3;border-radius:6px;overflow:hidden}
  .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary),#ff6f87);transition:width .35s}

  /* result */
  .result-card{text-align:center;padding:26px;border-radius:18px;background:var(--card);
    box-shadow:0 10px 30px rgba(0,0,0,0.06);margin-top:22px}
  .result-title{color:var(--primary);font-size:20px;font-weight:800;margin-bottom:8px}
  .result-text{color:#444;line-height:1.6;margin-bottom:12px}

  .small-btn{display:inline-block;padding:10px 14px;border-radius:12px;background:#fff;border:1px solid #fde6eb;color:var(--primary);cursor:pointer}
  .small-btn:hover{background:linear-gradient(90deg,#fff,#fff8f9)}

  /* share modal */
  .modal{
    position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,0.45);
    display:none;align-items:center;justify-content:center;padding:20px;z-index:9999;
  }
  .modal-card{background:white;padding:18px;border-radius:14px;max-width:440px;width:100%;text-align:center}
  .share-img{width:100%;border-radius:12px;display:block;max-height:720px;object-fit:contain}
  .download-btn{display:inline-block;margin-top:10px;padding:10px 14px;border-radius:12px;background:var(--primary);color:#fff;border:none;cursor:pointer}

  /* responsive */
  @media (max-width:520px){
    .wrap{padding:14px}
    .cover-card{padding:22px}
    .question{font-size:17px}
  }
</style>
</head>
<body>
<div class="wrap">

  <div class="brand">
    <div class="logo">TA</div>
    <div>
      <h1>æš—æ‹æµ‹è¯•</h1>
      <p>å°çº¢ä¹¦é£ Â· 10 é“é¢˜ Â· è‡ªåŠ¨ç”Ÿæˆæµ·æŠ¥</p >
    </div>
  </div>

  <!-- cover -->
  <div id="cover" class="cover">
    <div class="cover-card">
      <div class="cover-title">TA æ˜¯ä¸æ˜¯åœ¨æš—æ‹ä½ ï¼Ÿ</div>
      <div class="cover-desc">å¡«å†™ä½ çš„æ˜µç§° â†’ å¼€å§‹ç­”é¢˜ï¼Œå®Œæˆåå¯ç”Ÿæˆä¸“å±å°çº¢ä¹¦é£æµ·æŠ¥</div>

      <div class="input-row" style="justify-content:center;margin-top:14px">
        <input id="nickname" class="name-input" placeholder="è¾“å…¥ä½ çš„æ˜µç§°ï¼ˆå¯ä¸å¡«ï¼‰" maxlength="20" />
        <button class="start-btn" onclick="startTest()">å¼€å§‹</button>
      </div>
    </div>
  </div>

  <!-- questions container -->
  <div id="qwrap" style="display:none">
    <div class="card">
      <div class="qnum" id="qnum">ç¬¬ 1 / 10 é¢˜</div>
      <div class="question" id="question">é—®é¢˜åŠ è½½ä¸­â€¦</div>

      <div id="opts"></div>

      <div class="progress-wrap">
        <div class="progress-bar" id="pbar"></div>
      </div>
    </div>
  </div>

  <!-- result -->
  <div id="resultWrap" style="display:none">
    <div class="result-card">
      <div class="result-title">æµ‹è¯•ç»“æœ</div>
      <div class="result-text" id="resultText">åŠ è½½ç»“æœ...</div>

      <div style="margin-top:12px">
        <button class="small-btn" onclick="restart()">å†æµ‹ä¸€æ¬¡</button>
        <button class="small-btn" id="saveBtn" style="margin-left:8px;border:0;background:linear-gradient(90deg,var(--primary),#ff6f87);color:#fff" onclick="generatePoster()">ç”Ÿæˆæµ·æŠ¥</button>
      </div>
    </div>
  </div>

</div>

<!-- share modal -->
<div id="modal" class="modal" onclick="closeModal(event)">
  <div class="modal-card" onclick="event.stopPropagation()">
    <div style="font-weight:700;margin-bottom:8px">é•¿æŒ‰ä¿å­˜æµ·æŠ¥ï¼ˆæˆ–ç‚¹å‡»ä¸‹è½½ï¼‰</div>
    < img id="shareImage" class="share-img" src="" alt="åˆ†äº«æµ·æŠ¥" />
    <div style="margin-top:10px">
      <a id="downloadLink" href=" " download="æš—æ‹æµ‹è¯•æµ·æŠ¥.png" class="download-btn">ä¸‹è½½å›¾ç‰‡</a >
    </div>
    <div style="margin-top:8px;color:#666;font-size:12px">ä¿å­˜åå¯åˆ†äº«åˆ°å°çº¢ä¹¦ / æœ‹å‹åœˆ</div>
  </div>
</div>

<script>
/* ========== é¢˜åº“ï¼ˆæš—æ‹ä¸“ç”¨ 10 é¢˜ï¼‰ ========== */
const questions = [
  "ä½ ä»¬èŠå¤©æ—¶ï¼Œå¦‚æœä½ ä¸å›æ¶ˆæ¯ï¼ŒTA ä¼šä¸»åŠ¨æ¥æ‰¾ä½ å—ï¼Ÿ",
  "TA åœ¨ä½ é¢å‰ä¼šå˜å¾—æ‹˜è°¨æˆ–ç´§å¼ å—ï¼Ÿ",
  "TA æ˜¯å¦ä¼šè®°ä½ä½ è¯´è¿‡çš„å°ç»†èŠ‚ï¼Ÿ",
  "TA ä¼šä¸»åŠ¨æ‰¾ç†ç”±å’Œä½ å•ç‹¬ç›¸å¤„å—ï¼Ÿ",
  "TA åœ¨ä½ é‡åˆ°å›°éš¾æ—¶ä¼šç‰¹åˆ«å…³å¿ƒä½ å—ï¼Ÿ",
  "TA æ˜¯å¦ä¼šåœ¨æœ‹å‹åœˆå¯¹ä½ æœ‰ä¸åŒçš„äº’åŠ¨ï¼ˆç‚¹èµ/è¯„è®º/ç§ä¿¡ï¼‰ï¼Ÿ",
  "ä½ ä»¬å¯¹è¯æ—¶ï¼ŒTA ä¼šé—®å¾ˆå¤šå…³äºä½ æœªæ¥/æ„Ÿæƒ…çš„é—®é¢˜å—ï¼Ÿ",
  "TA æ˜¯å¦ä¼šåˆ†äº«åªæƒ³ç»™ä½ çœ‹çš„ä¸œè¥¿ï¼ˆé“¾æ¥/éŸ³ä¹/ç§˜å¯†ï¼‰ï¼Ÿ",
  "TA çœ‹åˆ°ä½ æ—¶ä¼šè¡¨ç°å‡ºæ˜æ˜¾çš„å…³æ³¨ï¼ˆçœ¼ç¥/è¡¨æƒ…ï¼‰å—ï¼Ÿ",
  "TA æ›¾ç»è¯•æ¢è¿‡ä½ çš„æ„Ÿæƒ…çŠ¶æ€æˆ–é—®ä½ æœ‰æ²¡æœ‰å–œæ¬¢çš„äººå—ï¼Ÿ"
];

let idx = 0;
let score = 0;
let nick = "";

/* å¼€å§‹æµ‹è¯• */
function startTest(){
  nick = (document.getElementById('nickname').value || '').trim();
  document.getElementById('cover').style.display = 'none';
  document.getElementById('qwrap').style.display = 'block';
  idx = 0; score = 0;
  renderQuestion();
}

/* æ¸²æŸ“é¢˜ç›® */
function renderQuestion(){
  if(idx >= questions.length){
    showResult();
    return;
  }
  const q = questions[idx];
  document.getElementById('qnum').innerText = `ç¬¬ ${idx+1} / ${questions.length} é¢˜`;
  document.getElementById('question').innerText = q;

  // ä¸¤ä¸ªé€‰é¡¹ï¼šæ˜¯ / å¦ï¼ˆæ˜¯ = 1åˆ†ï¼‰
  const opts = document.getElementById('opts');
  opts.innerHTML = '';
  const yes = createOption('A. æ˜¯çš„ï¼Œå¾ˆæ˜æ˜¾', ()=>choose(1));
  const no  = createOption('B. ä¸å¤ªæ˜¯', ()=>choose(0));
  opts.appendChild(yes); opts.appendChild(no);

  // è¿›åº¦
  const pct = Math.round((idx/questions.length)*100);
  document.getElementById('pbar').style.width = pct + '%';
}

function createOption(label, onClick){
  const d = document.createElement('div');
  d.className = 'option';
  d.innerHTML = `<strong style="color:var(--primary);">${label.split('.')[0]}</strong><span>${label.substring(3)}</span>`;
  d.onclick = ()=>{
    d.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:220});
    setTimeout(onClick,120);
  };
  return d;
}

/* é€‰æ‹© */
function choose(v){
  score += v;
  idx++;
  renderQuestion();
}

/* ç»“æœæ˜¾ç¤º */
function showResult(){
  document.getElementById('qwrap').style.display = 'none';
  document.getElementById('resultWrap').style.display = 'block';

  let level = '';
  let text = '';
  if(score >= 8){
    level = 'é«˜åº¦æš—æ‹';
    text = 'ğŸ’– åæœ‰å…«ä¹ TA åœ¨æš—æ‹ä½ ï¼å¾ˆå¤šç»†èŠ‚éƒ½åœ¨è¯´æ˜ï¼šTA æ—¶åˆ»åœ¨æ„ä½ ï¼Œæƒ³é è¿‘ä½ ã€‚';
  }else if(score >= 5){
    level = 'æœ‰å¥½æ„Ÿ';
    text = 'ğŸŒ¸ TA å¯¹ä½ æœ‰æ˜æ˜¾å¥½æ„Ÿï¼Œä½†è¿˜åœ¨è¯•æ¢ä¸è§‚å¯Ÿã€‚è‹¥ä½ ä¹Ÿæœ‰æ„æ€ï¼Œå¤šç»™å›åº”ä¼šå¾ˆæœ‰æ•ˆã€‚';
  }else{
    level = 'ç›®å‰æ˜¯æœ‹å‹';
    text = 'ğŸƒ ç›®å‰æ›´å¤šåƒæœ‹å‹å…³ç³»ï¼ŒTA æš‚æœªè¡¨ç°å‡ºæ˜æ˜¾æ‹æ…•ã€‚ä½†æ„Ÿæƒ…å¯ä»¥æ…¢æ…¢åŸ¹å…»ã€‚';
  }

  const nickText = nick ? `${nick}ï¼Œ` : '';
  document.getElementById('resultText').innerHTML = `<div style="font-size:15px;margin-bottom:8px">${nickText}<strong style="color:var(--primary)">${level}</strong></div><div style="color:#555;line-height:1.6">${text}</div>`;
}

/* å†æµ‹ä¸€æ¬¡ */
function restart(){
  idx = 0; score = 0; nick = '';
  document.getElementById('nickname').value = '';
  document.getElementById('resultWrap').style.display = 'none';
  document.getElementById('cover').style.display = 'block';
}

/* ç”Ÿæˆåˆ†äº«æµ·æŠ¥ï¼ˆé™æ€ï¼‰ */
function generatePoster(){
  // canvas ç»˜åˆ¶ 900x1200ï¼ˆç«–ï¼‰é€‚åˆåˆ†äº«
  const canvasW = 900;
  const canvasH = 1200;
  const scale = window.devicePixelRatio || 1;
  const canvas = document.createElement('canvas');
  canvas.width = canvasW * scale;
  canvas.height = canvasH * scale;
  canvas.style.width = canvasW + 'px';
  canvas.style.height = canvasH + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(scale, scale);

  // èƒŒæ™¯ç²‰è‰²æ¸å˜
  const g = ctx.createLinearGradient(0,0,canvasW,canvasH);
  g.addColorStop(0,'#fff0f2');
  g.addColorStop(1,'#ffeef3');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,canvasW,canvasH);

  // é¡¶éƒ¨è£…é¥°æ¡
  ctx.fillStyle = 'rgba(255,45,85,0.08)';
  roundRect(ctx,20,20,canvasW-40,160,20,true,false);

  // æ ‡é¢˜
  ctx.fillStyle = '#ff2d55';
  ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei"';
  ctx.textAlign = 'left';
  ctx.fillText('TA æ˜¯ä¸æ˜¯åœ¨æš—æ‹ä½ ï¼Ÿ', 40, 78);

  // æ˜µç§°ä¸ç­‰çº§
  const name = nick || 'åŒ¿å';
  let level = '';
  let short = '';
  if(score >= 8){
    level = 'é«˜åº¦æš—æ‹';
    short = 'åæœ‰å…«ä¹ TA åœ¨æš—æ‹ä½ ï¼';
  } else if(score >=5){
    level = 'æœ‰å¥½æ„Ÿ';
    short = 'TA å¯¹ä½ æœ‰æ˜æ˜¾å¥½æ„Ÿï½';
  } else {
    level = 'ç›®å‰æ˜¯æœ‹å‹';
    short = 'æ›´å¤šåƒæœ‹å‹ï¼Œæ…¢æ…¢æ¥ï½';
  }

  ctx.fillStyle = '#333';
  ctx.font = 'bold 28px "PingFang SC", "Microsoft YaHei"';
  ctx.fillText(`${name} çš„æš—æ‹ç»“æœï¼š`, 40, 150);

  // å¡ç‰‡åŒºåŸŸ
  const cardX = 40, cardY = 190, cardW = canvasW - 80, cardH = 520;
  // å¡ç‰‡èƒŒæ™¯ç™½
  ctx.fillStyle = '#fff';
  roundRect(ctx, cardX, cardY, cardW, cardH, 20, true, false);

  // åœ¨å¡ç‰‡ä¸Šå†™ç­‰çº§ (å¤§)
  ctx.fillStyle = '#ff2d55';
  ctx.font = 'bold 42px "PingFang SC", "Microsoft YaHei"';
  ctx.textAlign = 'left';
  ctx.fillText(level, cardX + 34, cardY + 90);

  // ç»“æœçŸ­æ–‡
  ctx.fillStyle = '#444';
  ctx.font = '18px "PingFang SC", "Microsoft YaHei"';
  wrapText(ctx, short, cardX + 34, cardY + 140, cardW - 68, 26);

  // ç»†èŠ‚ï¼šåˆ†æ•°å’Œæç¤º
  ctx.fillStyle = '#777';
  ctx.font = '15px "PingFang SC", "Microsoft YaHei"';
  ctx.fillText(`å¾—åˆ†ï¼š${score} / ${questions.length}`, cardX + 34, cardY + 220);
  ctx.fillText('æç¤ºï¼šæµ‹è¯•ä»…ä¾›å‚è€ƒï¼ŒçœŸå®å…³ç³»è¦çœ‹æ—¥å¸¸äº’åŠ¨å“¦ã€‚', cardX + 34, cardY + 250);

  // åº•éƒ¨å°çº¢ä¹¦é£æ ‡ç­¾
  ctx.fillStyle = '#ff2d55';
  ctx.font = 'bold 16px "PingFang SC", "Microsoft YaHei"';
  ctx.fillText('â€” å°çº¢ä¹¦é£æš—æ‹æµ‹è¯• â€”', cardX + 34, cardY + cardH - 34);

  // corner heart icon
  drawHeart(ctx, canvasW - 110, cardY + 40, 36, '#ff2d55');

  // å¯¼å‡ºå›¾ç‰‡å¹¶å±•ç¤º modal
  const dataURL = canvas.toDataURL('image/png');
  showModalWithImage(dataURL);
}

/* helpers: rounded rect */
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  if (typeof r === 'undefined') r = 5;
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
  if(fill){ ctx.fill(); }
  if(stroke){ ctx.stroke(); }
}

/* helpers: wrap text */
function wrapText(ctx, text, x, y, maxWidth, lineHeight){
  const words = text.split(' ');
  let line = '';
  // support Chinese characters: iterate by char when needed
  // simpler: measure and break by char
  let cur = '';
  for(let i=0;i<text.length;i++){
    cur += text[i];
    const w = ctx.measureText(cur).width;
    if(w > maxWidth){
      ctx.fillText(cur.slice(0,-1), x, y);
      cur = text[i];
      y += lineHeight;
    }
  }
  if(cur) ctx.fillText(cur, x, y);
}

/* draw simple heart */
function drawHeart(ctx, x, y, size, color){
  ctx.fillStyle = color;
  ctx.beginPath();
  const topCurveHeight = size * 0.3;
  ctx.moveTo(x, y + topCurveHeight);
  ctx.bezierCurveTo(
    x, y,
    x - size/2, y,
    x - size/2, y + topCurveHeight
  );
  ctx.bezierCurveTo(
    x - size/2, y + (size+topCurveHeight)/2,
    x, y + (size+topCurveHeight)/1.2,
    x, y + size
  );
  ctx.bezierCurveTo(
    x, y + (size+topCurveHeight)/1.2,
    x + size/2, y + (size+topCurveHeight)/2,
    x + size/2, y + topCurveHeight
  );
  ctx.bezierCurveTo(
    x + size/2, y,
    x, y,
    x, y + topCurveHeight
  );
  ctx.closePath();
  ctx.fill();
}

/* show modal */
function showModalWithImage(dataURL){
  const modal = document.getElementById('modal');
  const img = document.getElementById('shareImage');
  const link = document.getElementById('downloadLink');
  img.src = dataURL;
  link.href = dataURL;
  modal.style.display = 'flex';
}

/* close modal */
function closeModal(e){
  document.getElementById('modal').style.display = 'none';
}

/* utility for copy / fallback */
document.addEventListener('DOMContentLoaded', ()=>{
  // tap outside modal closes handled by onclick
});
</script>
</body>
</html>
